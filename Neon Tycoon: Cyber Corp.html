<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SINGULARITY TYCOON v4.0 üëÅÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #030305;
            --primary: #fcee0a; /* Cyber Yellow */
            --primary-dim: rgba(252, 238, 10, 0.2);
            --accent: #00d9f7; /* Cyan */
            --danger: #ff2a6d;
            --text: #e0e0e0;
            --panel: rgba(20, 20, 25, 0.85);
            --border: 1px solid rgba(255, 255, 255, 0.15);
        }

        * { box-sizing: border-box; user-select: none; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- CRT SCANLINE EFFECT --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none; z-index: 999; opacity: 0.6;
        }

        /* --- UI COMPONENTS --- */
        .btn {
            background: var(--primary); color: #000;
            border: none; padding: 10px 20px;
            font-family: 'Rajdhani', sans-serif; font-weight: 700; text-transform: uppercase;
            letter-spacing: 1px; cursor: pointer;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
            transition: all 0.1s;
        }
        .btn:active { transform: translateY(2px); background: #fff; }
        .btn:disabled { background: #333; color: #555; cursor: not-allowed; transform: none; }
        
        .btn-glitch {
            background: var(--danger); color: #fff;
            animation: glitch-anim 3s infinite;
        }

        /* --- HEADER --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px;
            background: var(--panel); border-bottom: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(5px); z-index: 10;
        }
        .currency-box { display: flex; flex-direction: column; }
        .label { font-size: 0.7rem; color: #888; letter-spacing: 2px; text-transform: uppercase; }
        .val-main { font-size: 1.8rem; font-weight: 700; color: var(--primary); text-shadow: 0 0 10px var(--primary-dim); }
        .val-sec { font-size: 0.9rem; color: var(--accent); }

        .sys-btns { display: flex; gap: 10px; }
        .icon-box { 
            width: 40px; height: 40px; border: var(--border); display: flex; 
            align-items: center; justify-content: center; cursor: pointer; color: var(--accent);
            background: rgba(0,0,0,0.3); transition: 0.2s;
        }
        .icon-box:hover { background: var(--accent); color: #000; }

        /* --- MAIN LAYOUT --- */
        main { flex: 1; display: flex; position: relative; overflow: hidden; }

        /* LEFT: VISUALIZER */
        #visual-sector {
            flex: 1; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; position: relative;
        }
        
        #core-btn {
            width: 200px; height: 200px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            background: radial-gradient(circle, rgba(252,238,10,0.1) 0%, rgba(0,0,0,0.8) 70%);
            box-shadow: 0 0 30px var(--primary-dim), inset 0 0 20px var(--primary-dim);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; position: relative; z-index: 5;
            transition: transform 0.05s;
        }
        #core-btn:active { transform: scale(0.95); }
        #core-btn i { font-size: 4rem; font-style: normal; text-shadow: 0 0 10px #fff; }

        #hacking-terminal {
            position: absolute; bottom: 20px; left: 20px;
            padding: 10px 20px; border: 1px solid var(--accent);
            color: var(--accent); font-size: 0.8rem; background: rgba(0,0,0,0.8);
            cursor: pointer; display: none;
            animation: blink-border 1s infinite;
        }
        @keyframes blink-border { 50% { border-color: transparent; color: #fff; } }

        /* RIGHT: DATA */
        #data-sector {
            width: 400px; background: var(--panel); border-left: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column; z-index: 20;
        }
        @media(max-width: 800px) {
            main { flex-direction: column; }
            #data-sector { width: 100%; height: 60%; position: absolute; bottom: 0; border-top: 1px solid var(--primary); }
            #visual-sector { height: 40%; }
            #core-btn { width: 160px; height: 160px; }
        }

        .tabs { display: flex; background: rgba(0,0,0,0.5); }
        .tab { flex: 1; padding: 15px; text-align: center; color: #666; cursor: pointer; text-transform: uppercase; font-weight: 600; letter-spacing: 1px; transition: 0.3s; border-bottom: 2px solid transparent; }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); background: rgba(252,238,10,0.05); }

        .scroll-area { flex: 1; overflow-y: auto; padding: 10px; }
        
        /* ITEMS */
        .card {
            background: linear-gradient(90deg, rgba(255,255,255,0.03), transparent);
            border-left: 2px solid #333; padding: 10px; margin-bottom: 8px;
            display: flex; align-items: center; gap: 10px; transition: 0.2s; cursor: pointer;
        }
        .card:hover { border-left-color: var(--primary); background: rgba(255,255,255,0.05); }
        .card.locked { opacity: 0.4; filter: grayscale(1); pointer-events: none; }
        
        .card-icon { font-size: 1.5rem; width: 40px; text-align: center; }
        .card-info { flex: 1; }
        .card-name { font-weight: 700; color: #fff; }
        .card-cost { font-size: 0.8rem; color: var(--danger); }
        .card-gain { font-size: 0.8rem; color: var(--accent); }
        .card-lvl { font-size: 1.2rem; font-weight: 700; color: #444; margin-right: 10px; }

        /* SKILL TREE */
        .skill-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .skill-node {
            border: 1px solid #444; padding: 15px; text-align: center; cursor: pointer; position: relative;
            background: rgba(0,0,0,0.5); transition: 0.3s;
        }
        .skill-node.bought { border-color: var(--success); box-shadow: 0 0 10px rgba(0,255,0,0.2); }
        .skill-node:hover { border-color: var(--primary); }
        
        /* HACKING MINIGAME OVERLAY */
        #hack-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.95); z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .grid-hack { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .cell-hack {
            width: 80px; height: 80px; border: 2px solid var(--accent);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: var(--accent); cursor: pointer;
            transition: 0.2s;
        }
        .cell-hack:active { background: var(--accent); color: #000; }
        .cell-hack.lit { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary); border-color: var(--primary); }

        /* PARTICLES */
        .particle {
            position: absolute; pointer-events: none; color: var(--primary); font-weight: bold;
            animation: flyUp 0.8s forwards; font-size: 1.2rem; text-shadow: 0 0 5px var(--primary);
        }
        @keyframes flyUp { to { transform: translateY(-100px); opacity: 0; } }

        /* AUDIO START OVERLAY */
        #start-screen {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: #000; z-index: 500; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <div class="scanlines"></div>

    <!-- START SCREEN (REQUIRED FOR AUDIO CONTEXT) -->
    <div id="start-screen">
        <h1 style="font-size: 3rem; color: var(--primary); text-shadow: 0 0 20px var(--primary);">SINGULARITY</h1>
        <p style="color: #666; margin-bottom: 30px;">TYCOON SIMULATION v4.0</p>
        <button class="btn" style="font-size: 1.5rem;" onclick="startGame()">INICIAR SISTEMA</button>
    </div>

    <!-- HACKING MINIGAME -->
    <div id="hack-overlay">
        <h2 style="color:var(--accent)">ACESSO DE SEGURAN√áA</h2>
        <p id="hack-status">Memorize a sequ√™ncia...</p>
        <div class="grid-hack" id="hack-grid">
            <!-- 9 cells generated by JS -->
        </div>
    </div>

    <header>
        <div class="currency-box">
            <span class="label">CREDITS (CR$)</span>
            <div class="val-main" id="money-disp">0</div>
        </div>
        <div class="currency-box" style="align-items: flex-end;">
            <span class="label">NEURAL DATA (ND)</span>
            <div class="val-sec" style="color:var(--danger); font-size: 1.2rem;" id="prestige-disp">0</div>
        </div>
        <div class="sys-btns">
            <div class="icon-box" onclick="toggleMute()" id="mute-btn">üîä</div>
            <div class="icon-box" onclick="saveGame(true)">üíæ</div>
        </div>
    </header>

    <main>
        <section id="visual-sector">
            <div id="core-btn" onpointerdown="manualMine(event)">
                <i>üí†</i>
            </div>
            <div style="margin-top: 20px; color: #666; font-size: 0.8rem;" id="gps-disp">0 CR$/s</div>
            
            <button id="hacking-terminal" onclick="startHack()">
                ‚ö†Ô∏è ANOMALIA DETECTADA // CLIQUE PARA HACKEAR
            </button>
        </section>

        <section id="data-sector">
            <div class="tabs">
                <div class="tab active" onclick="setTab('infra')">INFRA</div>
                <div class="tab" onclick="setTab('neural')">NEURAL</div>
                <div class="tab" onclick="setTab('sys')">SYSTEM</div>
            </div>

            <!-- TAB: INFRASTRUCTURE -->
            <div id="tab-infra" class="scroll-area">
                <div id="buildings-list"></div>
            </div>

            <!-- TAB: NEURAL (SKILLS) -->
            <div id="tab-neural" class="scroll-area" style="display:none;">
                <div style="padding:10px; background: rgba(255,42,109,0.1); border: 1px solid var(--danger); margin-bottom: 15px;">
                    <div style="color:var(--danger); font-weight:bold;">REINICIAR A SIMULA√á√ÉO</div>
                    <p style="font-size:0.8rem;">Converta seus bens em Neural Data. (Min: 1M CR$)</p>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span id="prestige-potential" style="font-size:1.2rem; font-weight:bold;">+0 ND</span>
                        <button class="btn" style="background:var(--danger); color:#fff; font-size:0.8rem;" onclick="doPrestige()">RESETAR</button>
                    </div>
                </div>
                <h3 style="color:var(--accent); border-bottom:1px solid #333;">ARVORE DE HABILIDADES</h3>
                <div class="skill-grid" id="skills-list"></div>
            </div>

            <!-- TAB: SYSTEM -->
            <div id="tab-sys" class="scroll-area" style="display:none; text-align:center;">
                <h2 style="color:var(--primary)">ESTAT√çSTICAS</h2>
                <p>Tempo Online: <span id="stat-time">0</span>s</p>
                <p>Cliques Totais: <span id="stat-clicks">0</span></p>
                <p>Ganhos Totais: <span id="stat-earnings">0</span></p>
                <hr style="border-color:#333">
                <button class="btn" style="background:#333; color:#fff; width:100%; margin-top:20px;" onclick="hardReset()">WIPE SAVE DATA</button>
            </div>
        </section>
    </main>

    <script>
        /* --- AUDIO ENGINE (PROCEDURAL) --- */
        const AudioSys = {
            ctx: null,
            muted: false,
            init: function() {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
                this.ctx = new AudioContext();
            },
            playTone: function(freq, type, duration, vol=0.1) {
                if (this.muted || !this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            },
            playClick: function() { this.playTone(800 + Math.random()*200, 'sine', 0.1, 0.05); },
            playBuy: function() { this.playTone(400, 'square', 0.1, 0.05); this.playTone(600, 'square', 0.2, 0.05); },
            playError: function() { this.playTone(150, 'sawtooth', 0.3, 0.1); },
            playHackWin: function() { 
                [0, 100, 200].forEach(t => setTimeout(() => this.playTone(1000 + t, 'sine', 0.2, 0.1), t));
            }
        };

        /* --- DATA --- */
        const DB = {
            buildings: [
                { id: 0, name: "Data Miner", cost: 15, income: 1, icon: "üíæ" },
                { id: 1, name: "Bot Network", cost: 100, income: 5, icon: "ü§ñ" },
                { id: 2, name: "Server Rack", cost: 1100, income: 22, icon: "üîã" },
                { id: 3, name: "AI Cluster", cost: 12000, income: 85, icon: "üß†" },
                { id: 4, name: "Quantum Core", cost: 130000, income: 350, icon: "‚öõÔ∏è" },
                { id: 5, name: "Dyson Swarm", cost: 1500000, income: 1500, icon: "‚òÄÔ∏è" },
                { id: 6, name: "Reality Engine", cost: 25000000, income: 8000, icon: "üåÄ" }
            ],
            skills: [
                { id: 'auto_click', name: "Auto-Clicker", cost: 5, desc: "Cliques autom√°ticos 1x/s", max: 1 },
                { id: 'cheaper', name: "Otimiza√ß√£o", cost: 10, desc: "Pr√©dios 10% mais baratos", max: 1 },
                { id: 'offline', name: "Deep Sleep", cost: 15, desc: "Ganhos Offline x2", max: 1 },
                { id: 'hack_freq', name: "Backdoor", cost: 25, desc: "Hacks aparecem mais r√°pido", max: 1 }
            ]
        };

        /* --- STATE --- */
        let game = {
            money: 0,
            neuralData: 0,
            buildings: Array(DB.buildings.length).fill(0),
            skills: {}, // { 'auto_click': 1 }
            startTime: Date.now(),
            stats: { clicks: 0, earnings: 0 }
        };

        let incomePerSec = 0;
        let hackMultiplier = 1; // x10 during hack bonus
        let hackTimer = 0;
        let eventTimer = 0;

        /* --- INIT --- */
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            AudioSys.init();
            loadGame();
            renderUI();
            requestAnimationFrame(loop);
            setInterval(saveGame, 30000); // Auto save
        }

        /* --- MAIN LOOP --- */
        let lastTime = 0;
        function loop(timestamp) {
            if (!lastTime) lastTime = timestamp;
            let dt = (timestamp - lastTime) / 1000;
            lastTime = timestamp;

            // Income Calc
            let baseIncome = 0;
            DB.buildings.forEach((b, i) => baseIncome += b.income * game.buildings[i]);
            
            // Skill: Auto Clicker
            if (game.skills['auto_click']) {
                baseIncome += (baseIncome * 0.05); // Auto click adds 5% DPS roughly
            }

            incomePerSec = baseIncome * hackMultiplier;
            
            // Apply Income
            if (incomePerSec > 0) {
                let gain = incomePerSec * dt;
                addMoney(gain);
            }

            // Hack Bonus Timer
            if (hackMultiplier > 1) {
                hackTimer -= dt;
                document.getElementById('gps-disp').style.color = 'var(--danger)';
                document.getElementById('gps-disp').innerText = `üî• HACK ATIVO: ${(hackTimer).toFixed(1)}s (x10) üî•`;
                if (hackTimer <= 0) {
                    hackMultiplier = 1;
                    document.getElementById('gps-disp').style.color = '#666';
                }
            } else {
                document.getElementById('gps-disp').innerText = formatMoney(incomePerSec) + " CR$/s";
            }

            // Random Event Spawner
            eventTimer += dt;
            let freq = game.skills['hack_freq'] ? 45 : 90;
            if (eventTimer > freq) { // Spawn hack every 45-90s
                if (Math.random() > 0.5) showHackBtn();
                eventTimer = 0;
            }

            // UI Updates (Throttled slightly could be better but modern browsers handle this)
            updateDisplays();
            
            requestAnimationFrame(loop);
        }

        /* --- CORE FUNCTIONS --- */
        function addMoney(amount) {
            game.money += amount;
            game.stats.earnings += amount;
        }

        function manualMine(e) {
            game.stats.clicks++;
            let val = 1 + (incomePerSec * 0.05); // Click = 5% of DPS
            addMoney(val);
            
            AudioSys.playClick();
            
            // Visuals
            spawnParticle(e.clientX, e.clientY, "+" + formatMoney(val));
            let btn = document.getElementById('core-btn');
            btn.style.transform = "scale(0.95)";
            setTimeout(() => btn.style.transform = "scale(1)", 50);
        }

        function buyBuilding(id) {
            let b = DB.buildings[id];
            let discount = game.skills['cheaper'] ? 0.9 : 1.0;
            let cost = Math.floor(b.cost * Math.pow(1.15, game.buildings[id]) * discount);

            if (game.money >= cost) {
                game.money -= cost;
                game.buildings[id]++;
                AudioSys.playBuy();
                renderBuildings();
            } else {
                AudioSys.playError();
            }
        }

        function buySkill(id) {
            let s = DB.skills.find(x => x.id === id);
            if (game.neuralData >= s.cost && !game.skills[id]) {
                game.neuralData -= s.cost;
                game.skills[id] = 1;
                AudioSys.playBuy();
                renderSkills();
            }
        }

        function doPrestige() {
            let potential = Math.floor(Math.sqrt(game.money / 1000000));
            if (potential < 1) return;

            if(confirm("Reiniciar simula√ß√£o? Voc√™ perder√° Cr√©ditos e Pr√©dios, mas ganhar√° Neural Data.")) {
                game.neuralData += potential;
                game.money = 0;
                game.buildings.fill(0);
                saveGame(true);
                location.reload();
            }
        }

        /* --- HACKING MINI-GAME --- */
        function showHackBtn() {
            let btn = document.getElementById('hacking-terminal');
            btn.style.display = "block";
        }

        function startHack() {
            document.getElementById('hacking-terminal').style.display = "none";
            document.getElementById('hack-overlay').style.display = "flex";
            
            // Generate Grid
            let grid = document.getElementById('hack-grid');
            grid.innerHTML = "";
            for(let i=0; i<9; i++) {
                let d = document.createElement('div');
                d.className = 'cell-hack';
                d.id = 'hack-cell-'+i;
                d.innerText = Math.floor(Math.random()*99);
                d.onclick = () => checkHack(i);
                grid.appendChild(d);
            }

            // Sequence Logic
            runHackSequence();
        }

        let hackSeq = [];
        let playerSeq = [];
        
        async function runHackSequence() {
            hackSeq = [];
            playerSeq = [];
            document.getElementById('hack-status').innerText = "OBSERVE O PADR√ÉO...";
            
            // Create sequence of 4
            for(let i=0; i<4; i++) hackSeq.push(Math.floor(Math.random()*9));

            // Play sequence
            for(let id of hackSeq) {
                await new Promise(r => setTimeout(r, 600));
                let cell = document.getElementById('hack-cell-'+id);
                cell.classList.add('lit');
                AudioSys.playTone(600, 'sine', 0.1);
                await new Promise(r => setTimeout(r, 300));
                cell.classList.remove('lit');
            }
            
            document.getElementById('hack-status').innerText = "REPITA O PADR√ÉO AGORA!";
        }

        function checkHack(id) {
            playerSeq.push(id);
            AudioSys.playTone(800, 'sine', 0.1);
            
            // Validate step
            let idx = playerSeq.length - 1;
            if (playerSeq[idx] !== hackSeq[idx]) {
                // Fail
                document.getElementById('hack-status').innerText = "FALHA DE ACESSO!";
                document.getElementById('hack-status').style.color = "var(--danger)";
                AudioSys.playError();
                setTimeout(() => document.getElementById('hack-overlay').style.display = "none", 1000);
                return;
            }

            // Success
            if (playerSeq.length === hackSeq.length) {
                document.getElementById('hack-status').innerText = "ACESSO CONCEDIDO! BONUS ATIVO!";
                document.getElementById('hack-status').style.color = "var(--success)";
                AudioSys.playHackWin();
                hackMultiplier = 10;
                hackTimer = 30; // 30 seconds bonus
                setTimeout(() => document.getElementById('hack-overlay').style.display = "none", 1000);
            }
        }

        /* --- UI RENDERERS --- */
        function updateDisplays() {
            document.getElementById('money-disp').innerText = formatMoney(game.money);
            document.getElementById('prestige-disp').innerText = game.neuralData;
            
            let potential = Math.floor(Math.sqrt(game.money / 1000000));
            document.getElementById('prestige-potential').innerText = "+" + potential + " ND";

            document.getElementById('stat-time').innerText = Math.floor((Date.now() - game.startTime)/1000);
            document.getElementById('stat-clicks').innerText = game.stats.clicks;
            document.getElementById('stat-earnings').innerText = formatMoney(game.stats.earnings);

            // Grey out expensive buttons
            DB.buildings.forEach((b, i) => {
                let el = document.getElementById('b-card-'+i);
                if (el) {
                     let discount = game.skills['cheaper'] ? 0.9 : 1.0;
                     let cost = Math.floor(b.cost * Math.pow(1.15, game.buildings[i]) * discount);
                     if (game.money < cost) el.style.opacity = 0.5; else el.style.opacity = 1;
                }
            });
        }

        function renderBuildings() {
            let container = document.getElementById('buildings-list');
            container.innerHTML = "";
            DB.buildings.forEach((b, i) => {
                let discount = game.skills['cheaper'] ? 0.9 : 1.0;
                let cost = Math.floor(b.cost * Math.pow(1.15, game.buildings[i]) * discount);
                
                let div = document.createElement('div');
                div.className = "card";
                div.id = "b-card-"+i;
                div.onclick = () => buyBuilding(i);
                div.innerHTML = `
                    <div class="card-icon">${b.icon}</div>
                    <div class="card-info">
                        <div class="card-name">${b.name}</div>
                        <div class="card-cost">${formatMoney(cost)} CR$</div>
                    </div>
                    <div class="card-lvl">${game.buildings[i]}</div>
                `;
                container.appendChild(div);
            });
        }

        function renderSkills() {
            let container = document.getElementById('skills-list');
            container.innerHTML = "";
            DB.skills.forEach(s => {
                let owned = game.skills[s.id];
                let div = document.createElement('div');
                div.className = "skill-node " + (owned ? "bought" : "");
                div.onclick = () => buySkill(s.id);
                div.innerHTML = `
                    <div style="font-weight:bold; color:var(--accent)">${s.name}</div>
                    <div style="font-size:0.7rem; margin: 5px 0;">${s.desc}</div>
                    <div style="color:var(--danger)">${owned ? "ADQUIRIDO" : s.cost + " ND"}</div>
                `;
                container.appendChild(div);
            });
        }

        function renderUI() {
            renderBuildings();
            renderSkills();
        }

        function setTab(id) {
            ['infra', 'neural', 'sys'].forEach(t => document.getElementById('tab-'+t).style.display = 'none');
            document.getElementById('tab-'+id).style.display = 'block';
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        /* --- UTILS --- */
        function formatMoney(n) {
            if (n < 1000) return Math.floor(n);
            let s = ["", "k", "M", "B", "T", "Qa"];
            let t = Math.floor(Math.log10(n)/3);
            return (n / Math.pow(10, t*3)).toFixed(2) + s[t];
        }

        function spawnParticle(x, y, txt) {
            let p = document.createElement('div');
            p.className = 'particle';
            p.style.left = x + 'px';
            p.style.top = y + 'px';
            p.innerText = txt;
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);
        }

        function toggleMute() {
            AudioSys.muted = !AudioSys.muted;
            document.getElementById('mute-btn').innerText = AudioSys.muted ? "üîá" : "üîä";
        }

        /* --- SAVING --- */
        function saveGame(notify) {
            localStorage.setItem('singularitySave', JSON.stringify(game));
            if(notify) alert("Sistema Salvo!");
        }
        function loadGame() {
            let d = localStorage.getItem('singularitySave');
            if(d) {
                let loaded = JSON.parse(d);
                game = { ...game, ...loaded };
                if (game.buildings.length < DB.buildings.length) game.buildings.push(0);
            }
        }
        function hardReset() {
            localStorage.removeItem('singularitySave');
            location.reload();
        }
    </script>
</body>
</html>
